{% extends 'base.html' %}
{% load static %}

{% block title %}í–¥ìˆ˜ ì¶”ì²œ ì•± - ë°ëª¨{% endblock %}

{% block header_title %}ğŸŒ¸ í–¥ìˆ˜ ì¶”ì²œ ì•± ë°ëª¨{% endblock %}
{% block header_subtitle %}ì‹¤ì œ ì•±ì—ì„œ í–¥ìˆ˜ ì§€ì‹ ì‹œìŠ¤í…œ í™œìš© ì˜ˆì‹œ{% endblock %}

{% block content %}
<div class="alert alert-info">
    <strong>ğŸ¯ ë°ëª¨ ì•±:</strong> ì‹¤ì œ í–¥ìˆ˜ ì¶”ì²œ ì•±ì˜ ì£¼ìš” ê¸°ëŠ¥ë“¤ì„ ì‹œë®¬ë ˆì´ì…˜í•©ë‹ˆë‹¤. ê° ê¸°ëŠ¥ì„ ì‚¬ìš©í•  ë•Œë§ˆë‹¤ ê´€ë ¨ëœ í–¥ìˆ˜ ì§€ì‹ì´ í‘œì‹œë©ë‹ˆë‹¤.
</div>

<!-- ì‚¬ìš©ì ì •ë³´ ì…ë ¥ -->
<div class="card">
    <h3>ğŸ‘¤ ì‚¬ìš©ì ì •ë³´ ì…ë ¥</h3>
    <p>í–¥ìˆ˜ ì¶”ì²œì„ ìœ„í•œ ê°œì¸ ì •ë³´ë¥¼ ì…ë ¥í•˜ì„¸ìš”.</p>
    
    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin: 20px 0;">
        <div>
            <label style="display: block; margin-bottom: 5px; font-weight: bold;">ì„±ë³„</label>
            <select id="gender" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                <option value="">ì„ íƒí•˜ì„¸ìš”</option>
                <option value="male">ë‚¨ì„±</option>
                <option value="female">ì—¬ì„±</option>
                <option value="unisex">ìœ ë‹ˆì„¹ìŠ¤</option>
            </select>
        </div>
        
        <div>
            <label style="display: block; margin-bottom: 5px; font-weight: bold;">ë‚˜ì´ëŒ€</label>
            <select id="age" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                <option value="">ì„ íƒí•˜ì„¸ìš”</option>
                <option value="20s">20ëŒ€</option>
                <option value="30s">30ëŒ€</option>
                <option value="40s">40ëŒ€</option>
                <option value="50s">50ëŒ€ ì´ìƒ</option>
            </select>
        </div>
        
        <div>
            <label style="display: block; margin-bottom: 5px; font-weight: bold;">ì„ í˜¸ ê³„ì ˆ</label>
            <select id="season" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                <option value="">ì„ íƒí•˜ì„¸ìš”</option>
                <option value="spring">ë´„</option>
                <option value="summer">ì—¬ë¦„</option>
                <option value="autumn">ê°€ì„</option>
                <option value="winter">ê²¨ìš¸</option>
            </select>
        </div>
        
        <div>
            <label style="display: block; margin-bottom: 5px; font-weight: bold;">ì„ í˜¸ í–¥ì¡°</label>
            <select id="note" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                <option value="">ì„ íƒí•˜ì„¸ìš”</option>
                <option value="floral">í”Œë¡œëŸ´</option>
                <option value="woody">ìš°ë””</option>
                <option value="citrus">ì‹œíŠ¸ëŸ¬ìŠ¤</option>
                <option value="oriental">ì˜¤ë¦¬ì—”íƒˆ</option>
            </select>
        </div>
    </div>
    
    <button class="btn" onclick="saveUserInfo()">ì •ë³´ ì €ì¥</button>
</div>

<!-- í–¥ìˆ˜ ê²€ìƒ‰ -->
<div class="card">
    <h3>ğŸ” í–¥ìˆ˜ ê²€ìƒ‰</h3>
    <p>ë¸Œëœë“œë‚˜ í–¥ìˆ˜ëª…ìœ¼ë¡œ ê²€ìƒ‰í•´ë³´ì„¸ìš”.</p>
    
    <div style="display: flex; gap: 10px; margin: 20px 0;">
        <input type="text" id="searchInput" placeholder="í–¥ìˆ˜ëª… ë˜ëŠ” ë¸Œëœë“œëª… ì…ë ¥" 
               style="flex: 1; padding: 10px; border: 1px solid #ddd; border-radius: 4px;">
        <button class="btn" onclick="searchPerfumes()">ê²€ìƒ‰</button>
    </div>
    
    <div id="searchResults" style="margin-top: 20px;"></div>
</div>

<!-- í–¥ìˆ˜ ì¶”ì²œ -->
<div class="card">
    <h3>ğŸ’ ë§ì¶¤ í–¥ìˆ˜ ì¶”ì²œ</h3>
    <p>ì…ë ¥í•œ ì •ë³´ë¥¼ ë°”íƒ•ìœ¼ë¡œ ê°œì¸í™”ëœ í–¥ìˆ˜ë¥¼ ì¶”ì²œí•´ë“œë¦½ë‹ˆë‹¤.</p>
    
    <button class="btn btn-success" onclick="getRecommendations()">ì¶”ì²œ ë°›ê¸°</button>
    
    <div id="recommendations" style="margin-top: 20px;"></div>
</div>

<!-- í–¥ìˆ˜ ë¹„êµ -->
<div class="card">
    <h3>âš–ï¸ í–¥ìˆ˜ ë¹„êµ</h3>
    <p>ì—¬ëŸ¬ í–¥ìˆ˜ë¥¼ ì„ íƒí•˜ì—¬ ë¹„êµí•´ë³´ì„¸ìš”.</p>
    
    <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 15px; margin: 20px 0;">
        <select id="perfume1" style="padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
            <option value="">ì²« ë²ˆì§¸ í–¥ìˆ˜</option>
            <option value="chanel-no5">ìƒ¤ë„¬ No.5</option>
            <option value="dior-sauvage">ë””ì˜¬ ì†Œë°”ì£¼</option>
            <option value="tom-ford-black-orchid">í†° í¬ë“œ ë¸”ë™ ì˜¤í‚¤ë“œ</option>
        </select>
        
        <select id="perfume2" style="padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
            <option value="">ë‘ ë²ˆì§¸ í–¥ìˆ˜</option>
            <option value="chanel-no5">ìƒ¤ë„¬ No.5</option>
            <option value="dior-sauvage">ë””ì˜¬ ì†Œë°”ì£¼</option>
            <option value="tom-ford-black-orchid">í†° í¬ë“œ ë¸”ë™ ì˜¤í‚¤ë“œ</option>
        </select>
        
        <button class="btn btn-warning" onclick="comparePerfumes()">ë¹„êµí•˜ê¸°</button>
    </div>
    
    <div id="comparison" style="margin-top: 20px;"></div>
</div>

<!-- í–¥ìˆ˜ ì§€ì‹ í€´ì¦ˆ -->
<div class="card">
    <h3>ğŸ§  í–¥ìˆ˜ ì§€ì‹ í€´ì¦ˆ</h3>
    <p>í–¥ìˆ˜ì— ëŒ€í•œ ì§€ì‹ì„ í…ŒìŠ¤íŠ¸í•´ë³´ì„¸ìš”!</p>
    
    <button class="btn btn-danger" onclick="startQuiz()">í€´ì¦ˆ ì‹œì‘</button>
    
    <div id="quiz" style="margin-top: 20px;"></div>
</div>

<!-- ê²°ê³¼ í‘œì‹œ ì˜ì—­ -->
<div class="card">
    <h3>ğŸ“Š ì‹¤í–‰ ê²°ê³¼</h3>
    <div id="demo-result" style="min-height: 100px; padding: 15px; background: #f8f9fa; border-radius: 8px; border: 1px solid #e9ecef;">
        <em>ì•± ê¸°ëŠ¥ì„ ì‚¬ìš©í•˜ë©´ ê²°ê³¼ê°€ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤...</em>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
    // ê²°ê³¼ í‘œì‹œ í•¨ìˆ˜
    function showDemoResult(message, type = 'info') {
        const resultArea = document.getElementById('demo-result');
        const alertClass = type === 'error' ? 'alert-danger' : 'alert-success';
        resultArea.innerHTML = `<div class="alert ${alertClass}">${message}</div>`;
    }

    // ì‚¬ìš©ì ì •ë³´ ì €ì¥
    async function saveUserInfo() {
        const gender = document.getElementById('gender').value;
        const age = document.getElementById('age').value;
        const season = document.getElementById('season').value;
        const note = document.getElementById('note').value;
        
        if (!gender || !age || !season || !note) {
            showDemoResult('ëª¨ë“  ì •ë³´ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.', 'error');
            return;
        }
        
        try {
            const result = await showLoading(async () => {
                // ì‚¬ìš©ì ì •ë³´ ì €ì¥ ì‹œë®¬ë ˆì´ì…˜
                await new Promise(resolve => setTimeout(resolve, 2000));
                
                const userInfo = { gender, age, season, note };
                localStorage.setItem('userInfo', JSON.stringify(userInfo));
                
                return 'ì‚¬ìš©ì ì •ë³´ê°€ ì„±ê³µì ìœ¼ë¡œ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤!';
            });
            
            showDemoResult(result);
        } catch (error) {
            showDemoResult('ì •ë³´ ì €ì¥ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ' + error.message, 'error');
        }
    }

    // í–¥ìˆ˜ ê²€ìƒ‰
    async function searchPerfumes() {
        const query = document.getElementById('searchInput').value.trim();
        
        if (!query) {
            showDemoResult('ê²€ìƒ‰ì–´ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.', 'error');
            return;
        }
        
        try {
            const results = await showLoading(async () => {
                // ê²€ìƒ‰ ì‹œë®¬ë ˆì´ì…˜
                await new Promise(resolve => setTimeout(resolve, 2500));
                
                const mockResults = [
                    { name: `${query} - í´ë˜ì‹`, brand: 'ë¸Œëœë“œA', price: '150,000ì›' },
                    { name: `${query} - ëª¨ë˜`, brand: 'ë¸Œëœë“œB', price: '200,000ì›' },
                    { name: `${query} - í”„ë¦¬ë¯¸ì—„`, brand: 'ë¸Œëœë“œC', price: '300,000ì›' }
                ];
                
                return mockResults;
            });
            
            const resultsHtml = results.map(perfume => 
                `<div style="padding: 10px; border: 1px solid #ddd; border-radius: 4px; margin: 5px 0;">
                    <strong>${perfume.name}</strong><br>
                    ë¸Œëœë“œ: ${perfume.brand} | ê°€ê²©: ${perfume.price}
                </div>`
            ).join('');
            
            document.getElementById('searchResults').innerHTML = resultsHtml;
            showDemoResult(`"${query}"ì— ëŒ€í•œ ${results.length}ê°œì˜ ê²°ê³¼ë¥¼ ì°¾ì•˜ìŠµë‹ˆë‹¤.`);
            
        } catch (error) {
            showDemoResult('ê²€ìƒ‰ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ' + error.message, 'error');
        }
    }

    // í–¥ìˆ˜ ì¶”ì²œ
    async function getRecommendations() {
        const userInfo = JSON.parse(localStorage.getItem('userInfo') || '{}');
        
        if (!userInfo.gender) {
            showDemoResult('ë¨¼ì € ì‚¬ìš©ì ì •ë³´ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.', 'error');
            return;
        }
        
        try {
            const recommendations = await showLoading(async () => {
                // ì‹¤ì œ API í˜¸ì¶œ
                const params = new URLSearchParams({
                    gender: userInfo.gender,
                    season: userInfo.season || ''
                });
                
                const response = await fetch(`/spinner-tip/api/perfume-recommendations/?${params}`);
                const data = await response.json();
                
                return data.recommendations || [];
            });
            
            if (recommendations.length === 0) {
                document.getElementById('recommendations').innerHTML = 
                    '<p style="text-align: center; color: #666;">ì¶”ì²œí•  í–¥ìˆ˜ê°€ ì—†ìŠµë‹ˆë‹¤.</p>';
                showDemoResult('ì¶”ì²œ ì¡°ê±´ì— ë§ëŠ” í–¥ìˆ˜ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.', 'error');
                return;
            }
            
            const recommendationsHtml = recommendations.map((rec, index) => 
                `<div style="padding: 20px; border: 1px solid #ddd; border-radius: 12px; margin: 15px 0; background: linear-gradient(135deg, #f8f9fa 0%, #ffffff 100%); box-shadow: 0 3px 10px rgba(0,0,0,0.1); transition: transform 0.2s ease;">
                    <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 10px;">
                        <h4 style="margin: 0; color: #333;">${index + 1}. ${rec.brand} - ${rec.name}</h4>
                        <span style="background: #e3f2fd; color: #1976d2; padding: 4px 8px; border-radius: 20px; font-size: 0.8rem; font-weight: 600;">${rec.concentration}</span>
                    </div>
                    <p style="margin: 8px 0; color: #666; font-style: italic;">${rec.reason}</p>
                    <p style="margin: 8px 0; color: #555; line-height: 1.4;">${rec.description}</p>
                    <div style="margin-top: 15px;">
                        <a href="${rec.url}" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 8px 16px; border-radius: 20px; text-decoration: none; font-weight: 600; display: inline-block; transition: transform 0.2s ease;" 
                           onmouseover="this.style.transform='translateY(-2px)'" 
                           onmouseout="this.style.transform='translateY(0)'">
                            <i class="fas fa-eye"></i> ìƒì„¸ë³´ê¸°
                        </a>
                    </div>
                </div>`
            ).join('');
            
            document.getElementById('recommendations').innerHTML = recommendationsHtml;
            showDemoResult(`${recommendations.length}ê°œì˜ ë§ì¶¤ í–¥ìˆ˜ë¥¼ ì¶”ì²œí–ˆìŠµë‹ˆë‹¤!`);
            
        } catch (error) {
            showDemoResult('ì¶”ì²œ ìƒì„± ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ' + error.message, 'error');
        }
    }

    // í–¥ìˆ˜ ë¹„êµ
    async function comparePerfumes() {
        const perfume1 = document.getElementById('perfume1').value;
        const perfume2 = document.getElementById('perfume2').value;
        
        if (!perfume1 || !perfume2) {
            showDemoResult('ë¹„êµí•  ë‘ í–¥ìˆ˜ë¥¼ ëª¨ë‘ ì„ íƒí•´ì£¼ì„¸ìš”.', 'error');
            return;
        }
        
        if (perfume1 === perfume2) {
            showDemoResult('ì„œë¡œ ë‹¤ë¥¸ í–¥ìˆ˜ë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”.', 'error');
            return;
        }
        
        try {
            const comparison = await showLoading(async () => {
                // ë¹„êµ ë¶„ì„ ì‹œë®¬ë ˆì´ì…˜
                await new Promise(resolve => setTimeout(resolve, 2500));
                
                return {
                    perfume1: { name: perfume1, longevity: '8ì‹œê°„', sillage: 'ì¤‘ê°„', price: '200,000ì›' },
                    perfume2: { name: perfume2, longevity: '6ì‹œê°„', sillage: 'ê°•í•¨', price: '180,000ì›' }
                };
            });
            
            const comparisonHtml = `
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin: 20px 0;">
                    <div style="padding: 15px; border: 1px solid #ddd; border-radius: 8px; background: #f8f9fa;">
                        <h4>${comparison.perfume1.name}</h4>
                        <p>ì§€ì†ë ¥: ${comparison.perfume1.longevity}</p>
                        <p>í™•ì‚°ë ¥: ${comparison.perfume1.sillage}</p>
                        <p>ê°€ê²©: ${comparison.perfume1.price}</p>
                    </div>
                    <div style="padding: 15px; border: 1px solid #ddd; border-radius: 8px; background: #f8f9fa;">
                        <h4>${comparison.perfume2.name}</h4>
                        <p>ì§€ì†ë ¥: ${comparison.perfume2.longevity}</p>
                        <p>í™•ì‚°ë ¥: ${comparison.perfume2.sillage}</p>
                        <p>ê°€ê²©: ${comparison.perfume2.price}</p>
                    </div>
                </div>
            `;
            
            document.getElementById('comparison').innerHTML = comparisonHtml;
            showDemoResult('í–¥ìˆ˜ ë¹„êµ ë¶„ì„ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤!');
            
        } catch (error) {
            showDemoResult('ë¹„êµ ë¶„ì„ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ' + error.message, 'error');
        }
    }

    // í–¥ìˆ˜ ì§€ì‹ í€´ì¦ˆ
    async function startQuiz() {
        const questions = [
            {
                question: "í–¥ìˆ˜ì˜ í†± ë…¸íŠ¸ëŠ” ë³´í†µ ì–¼ë§ˆë‚˜ ì§€ì†ë˜ë‚˜ìš”?",
                options: ["10ë¶„", "1ì‹œê°„", "3ì‹œê°„", "í•˜ë£¨"],
                correct: 0
            },
            {
                question: "EDPëŠ” ë¬´ì—‡ì˜ ì¤„ì„ë§ì¸ê°€ìš”?",
                options: ["Eau de Parfum", "Extra de Parfum", "Elegant de Parfum", "Essential de Parfum"],
                correct: 0
            },
            {
                question: "í–¥ìˆ˜ë¥¼ ë³´ê´€í•  ë•Œ ê°€ì¥ ì¢‹ì€ ì¥ì†ŒëŠ”?",
                options: ["í–‡ë¹›ì´ ë“œëŠ” ê³³", "ì–´ë‘¡ê³  ì„œëŠ˜í•œ ê³³", "ëƒ‰ì¥ê³ ", "ìš•ì‹¤"],
                correct: 1
            }
        ];
        
        let currentQuestion = 0;
        let score = 0;
        
        async function showQuestion() {
            if (currentQuestion >= questions.length) {
                showDemoResult(`í€´ì¦ˆ ì™„ë£Œ! ì ìˆ˜: ${score}/${questions.length}`, 'success');
                return;
            }
            
            const q = questions[currentQuestion];
            const quizHtml = `
                <div style="padding: 20px; border: 1px solid #ddd; border-radius: 8px; background: #f8f9fa;">
                    <h4>ë¬¸ì œ ${currentQuestion + 1}: ${q.question}</h4>
                    ${q.options.map((option, index) => 
                        `<button class="btn" style="display: block; width: 100%; margin: 5px 0;" 
                                onclick="answerQuestion(${index})">${option}</button>`
                    ).join('')}
                </div>
            `;
            
            document.getElementById('quiz').innerHTML = quizHtml;
        }
        
        window.answerQuestion = async function(selectedIndex) {
            const q = questions[currentQuestion];
            const isCorrect = selectedIndex === q.correct;
            
            if (isCorrect) score++;
            
            try {
                await showLoading(async () => {
                    await new Promise(resolve => setTimeout(resolve, 1500));
                    return isCorrect ? 'ì •ë‹µì…ë‹ˆë‹¤!' : 'í‹€ë ¸ìŠµë‹ˆë‹¤.';
                });
                
                currentQuestion++;
                showQuestion();
                
            } catch (error) {
                showDemoResult('í€´ì¦ˆ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ' + error.message, 'error');
            }
        };
        
        showQuestion();
    }
</script>
{% endblock %}
